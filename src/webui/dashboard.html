<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Steam Depot ä¸‹è½½å™¨</title>
    <!-- plugin-info.js ç”±åç«¯åŠ¨æ€ç”Ÿæˆï¼Œè®¾ç½® window.__PLUGIN_NAME__ -->
    <script src="static/plugin-info.js" onerror="console.warn('plugin-info.js åŠ è½½å¤±è´¥')"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            200: '#bae6fd',
                            300: '#7dd3fc',
                            400: '#38bdf8',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            700: '#0369a1',
                            800: '#075985',
                            900: '#0c4a6e',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        [x-cloak] {
            display: none !important;
        }

        :root {
            --ease-smooth: cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            box-sizing: border-box;
        }

        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        .dark ::-webkit-scrollbar-thumb {
            background: #475569;
        }

        .dark ::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }

        .glass {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
        }

        .dark .glass {
            background: rgba(30, 41, 59, 0.8);
        }

        .card-hover {
            transition: all 0.3s var(--ease-smooth);
        }

        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-fade-in {
            animation: fadeIn 0.4s ease both;
        }

        @keyframes spin {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        .animate-spin {
            animation: spin 1s linear infinite;
        }
    </style>
</head>

<body class="bg-slate-50 dark:bg-slate-900 min-h-screen">
    <div id="app" class="max-w-6xl mx-auto p-6">
        <!-- é¡µé¢å¤´éƒ¨ -->
        <header class="mb-8 animate-fade-in">
            <div class="flex items-center gap-4 mb-2">
                <div
                    class="w-12 h-12 rounded-xl bg-gradient-to-br from-blue-800 to-slate-900 flex items-center justify-center text-2xl text-white shadow-lg">
                    ğŸ®
                </div>
                <div>
                    <h1 class="text-2xl font-bold text-slate-800 dark:text-white">Steam Depot ä¸‹è½½å™¨</h1>
                    <p class="text-slate-500 dark:text-slate-400 text-sm">ä» GitHub è·å– Steam æ¸¸æˆ Manifest å’Œè§£å¯†å¯†é’¥</p>
                </div>
            </div>
        </header>

        <!-- çŠ¶æ€å¡ç‰‡ -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
            <!-- è¿è¡ŒçŠ¶æ€ -->
            <div class="glass rounded-2xl p-6 card-hover animate-fade-in" style="animation-delay: 0.1s;">
                <div class="flex items-center gap-3 mb-3">
                    <div class="w-3 h-3 rounded-full" id="status-dot"></div>
                    <span class="text-sm font-medium text-slate-600 dark:text-slate-300">è¿è¡ŒçŠ¶æ€</span>
                </div>
                <p class="text-2xl font-bold text-slate-800 dark:text-white" id="status-text">åŠ è½½ä¸­...</p>
            </div>

            <!-- è¿è¡Œæ—¶é•¿ -->
            <div class="glass rounded-2xl p-6 card-hover animate-fade-in" style="animation-delay: 0.15s;">
                <div class="flex items-center gap-3 mb-3">
                    <span class="text-lg">â±ï¸</span>
                    <span class="text-sm font-medium text-slate-600 dark:text-slate-300">è¿è¡Œæ—¶é•¿</span>
                </div>
                <p class="text-2xl font-bold text-slate-800 dark:text-white" id="uptime-text">--</p>
            </div>

            <!-- å¤„ç†ç»Ÿè®¡ -->
            <div class="glass rounded-2xl p-6 card-hover animate-fade-in" style="animation-delay: 0.2s;">
                <div class="flex items-center gap-3 mb-3">
                    <span class="text-lg">ğŸ“Š</span>
                    <span class="text-sm font-medium text-slate-600 dark:text-slate-300">å¤„ç†ç»Ÿè®¡</span>
                </div>
                <p class="text-2xl font-bold text-slate-800 dark:text-white">
                    <span id="today-count">0</span>
                    <span class="text-sm font-normal text-slate-500 dark:text-slate-400">ä»Šæ—¥</span>
                    <span class="text-slate-300 dark:text-slate-600 mx-2">/</span>
                    <span id="total-count">0</span>
                    <span class="text-sm font-normal text-slate-500 dark:text-slate-400">æ€»è®¡</span>
                </p>
            </div>
        </div>

        <!-- é…ç½®åŒºåŸŸ -->
        <div class="glass rounded-2xl p-6 mb-8 animate-fade-in" style="animation-delay: 0.25s;">
            <h2 class="text-lg font-bold text-slate-800 dark:text-white mb-4">âš™ï¸ é…ç½®</h2>

            <div class="space-y-4">
                <!-- å¯ç”¨å¼€å…³ -->
                <div class="flex items-center justify-between p-4 bg-slate-100 dark:bg-slate-800 rounded-xl">
                    <div>
                        <p class="font-medium text-slate-800 dark:text-white">å¯ç”¨æ’ä»¶</p>
                        <p class="text-sm text-slate-500 dark:text-slate-400">æ˜¯å¦å¯ç”¨æ’ä»¶åŠŸèƒ½</p>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="config-enabled" class="sr-only peer"
                            onchange="updateConfig('enabled', this.checked)">
                        <div
                            class="w-11 h-6 bg-slate-300 peer-focus:outline-none rounded-full peer dark:bg-slate-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary-600">
                        </div>
                    </label>
                </div>

                <!-- è°ƒè¯•æ¨¡å¼ -->
                <div class="flex items-center justify-between p-4 bg-slate-100 dark:bg-slate-800 rounded-xl">
                    <div>
                        <p class="font-medium text-slate-800 dark:text-white">è°ƒè¯•æ¨¡å¼</p>
                        <p class="text-sm text-slate-500 dark:text-slate-400">å¯ç”¨åè¾“å‡ºè¯¦ç»†æ—¥å¿—</p>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="config-debug" class="sr-only peer"
                            onchange="updateConfig('debug', this.checked)">
                        <div
                            class="w-11 h-6 bg-slate-300 peer-focus:outline-none rounded-full peer dark:bg-slate-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary-600">
                        </div>
                    </label>
                </div>
            </div>
        </div>

        <!-- ç¾¤åˆ—è¡¨ -->
        <div class="glass rounded-2xl p-6 animate-fade-in" style="animation-delay: 0.3s;">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-lg font-bold text-slate-800 dark:text-white">ğŸ‘¥ ç¾¤ç®¡ç†</h2>
                <button onclick="loadGroups()" class="text-sm text-primary-600 hover:text-primary-700 font-medium">
                    ğŸ”„ åˆ·æ–°
                </button>
            </div>

            <div id="groups-container" class="space-y-2">
                <div class="text-center text-slate-500 dark:text-slate-400 py-8">
                    <div
                        class="animate-spin inline-block w-6 h-6 border-2 border-slate-300 border-t-primary-600 rounded-full mb-2">
                    </div>
                    <p>åŠ è½½ç¾¤åˆ—è¡¨...</p>
                </div>
            </div>
        </div>

        <!-- é¡µè„š -->
        <footer class="text-center text-slate-400 dark:text-slate-600 text-sm mt-8 animate-fade-in"
            style="animation-delay: 0.35s;">
            Steam Depot Plugin for NapCat | ä½¿ç”¨ #depot &lt;AppID&gt; ä¸‹è½½æ¸¸æˆæ•°æ®
        </footer>
    </div>

    <script>
        // è·å–æ’ä»¶åç§°ï¼ˆä» plugin-info.js æˆ– fallbackï¼‰
        function resolvePluginName() {
            if (typeof window.__PLUGIN_NAME__ === 'string') return window.__PLUGIN_NAME__;
            const pathParts = location.pathname.split('/').filter(Boolean);
            if (pathParts.length >= 2) return pathParts[1];
            return 'napcat-plugin-template';
        }

        const PLUGIN_NAME = resolvePluginName();
        const API_BASE = `/api/plugin/${PLUGIN_NAME}`;

        // æ·±è‰²æ¨¡å¼æ£€æµ‹
        if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }

        // API è¯·æ±‚å°è£…
        async function api(path, options = {}) {
            const res = await fetch(API_BASE + path, {
                headers: { 'Content-Type': 'application/json' },
                ...options
            });
            return res.json();
        }

        // åŠ è½½çŠ¶æ€
        async function loadStatus() {
            try {
                const res = await api('/status');
                if (res.code === 0) {
                    const { config, stats, uptimeFormatted } = res.data;

                    // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
                    const statusDot = document.getElementById('status-dot');
                    const statusText = document.getElementById('status-text');
                    if (config.enabled) {
                        statusDot.className = 'w-3 h-3 rounded-full bg-green-500';
                        statusText.textContent = 'è¿è¡Œä¸­';
                    } else {
                        statusDot.className = 'w-3 h-3 rounded-full bg-slate-400';
                        statusText.textContent = 'å·²ç¦ç”¨';
                    }

                    // æ›´æ–°è¿è¡Œæ—¶é•¿
                    document.getElementById('uptime-text').textContent = uptimeFormatted;

                    // æ›´æ–°ç»Ÿè®¡
                    document.getElementById('today-count').textContent = stats?.todayProcessed || 0;
                    document.getElementById('total-count').textContent = stats?.processed || 0;

                    // æ›´æ–°é…ç½®å¼€å…³
                    document.getElementById('config-enabled').checked = config.enabled;
                    document.getElementById('config-debug').checked = config.debug;
                }
            } catch (e) {
                console.error('åŠ è½½çŠ¶æ€å¤±è´¥:', e);
            }
        }

        // åŠ è½½ç¾¤åˆ—è¡¨
        async function loadGroups() {
            const container = document.getElementById('groups-container');
            try {
                const res = await api('/groups');
                if (res.code === 0 && res.data) {
                    if (res.data.length === 0) {
                        container.innerHTML = '<p class="text-center text-slate-500 dark:text-slate-400 py-8">æš‚æ— ç¾¤</p>';
                        return;
                    }
                    container.innerHTML = res.data.map(group => `
                        <div class="flex items-center justify-between p-3 bg-slate-100 dark:bg-slate-800 rounded-xl">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 rounded-full bg-slate-300 dark:bg-slate-700 flex items-center justify-center text-lg">
                                    ğŸ‘¥
                                </div>
                                <div>
                                    <p class="font-medium text-slate-800 dark:text-white">${group.group_name || 'æœªçŸ¥ç¾¤'}</p>
                                    <p class="text-xs text-slate-500 dark:text-slate-400">${group.group_id}</p>
                                </div>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" class="sr-only peer" ${group.enabled ? 'checked' : ''} 
                                    onchange="updateGroupConfig('${group.group_id}', this.checked)">
                                <div class="w-11 h-6 bg-slate-300 peer-focus:outline-none rounded-full peer dark:bg-slate-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary-600"></div>
                            </label>
                        </div>
                    `).join('');
                }
            } catch (e) {
                container.innerHTML = '<p class="text-center text-red-500 py-8">åŠ è½½å¤±è´¥</p>';
                console.error('åŠ è½½ç¾¤åˆ—è¡¨å¤±è´¥:', e);
            }
        }

        // æ›´æ–°é…ç½®
        async function updateConfig(key, value) {
            try {
                await api('/config', {
                    method: 'POST',
                    body: JSON.stringify({ [key]: value })
                });
                loadStatus();
            } catch (e) {
                console.error('æ›´æ–°é…ç½®å¤±è´¥:', e);
            }
        }

        // æ›´æ–°ç¾¤é…ç½®
        async function updateGroupConfig(groupId, enabled) {
            try {
                await api(`/groups/${groupId}/config`, {
                    method: 'POST',
                    body: JSON.stringify({ enabled })
                });
            } catch (e) {
                console.error('æ›´æ–°ç¾¤é…ç½®å¤±è´¥:', e);
            }
        }

        // åˆå§‹åŒ–
        loadStatus();
        loadGroups();

        // å®šæ—¶åˆ·æ–°çŠ¶æ€
        setInterval(loadStatus, 30000);
    </script>
</body>

</html>