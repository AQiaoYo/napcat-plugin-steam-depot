# NapCat æ’ä»¶å¼€å‘æ¨¡æ¿

ä¸€ä¸ªå¿«é€Ÿå¼€å§‹ NapCat æ’ä»¶å¼€å‘çš„æ¨¡æ¿é¡¹ç›®ã€‚

## ğŸ“ é¡¹ç›®ç»“æ„

```
napcat-plugin-template/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.ts              # æ’ä»¶å…¥å£ï¼Œå¯¼å‡ºç”Ÿå‘½å‘¨æœŸå‡½æ•°
â”‚   â”œâ”€â”€ config.ts             # é…ç½®å®šä¹‰å’Œ WebUI Schema
â”‚   â”œâ”€â”€ types.ts              # TypeScript ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â””â”€â”€ state.ts          # å…¨å±€çŠ¶æ€ç®¡ç†å•ä¾‹
â”‚   â”œâ”€â”€ handlers/
â”‚   â”‚   â””â”€â”€ message-handler.ts # æ¶ˆæ¯å¤„ç†å™¨
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â””â”€â”€ api-service.ts    # WebUI API è·¯ç”±
â”‚   â””â”€â”€ webui/
â”‚       â””â”€â”€ dashboard.html    # WebUI æ§åˆ¶å°é¡µé¢
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ copy-assets.js        # æ„å»ºåèµ„æºå¤åˆ¶è„šæœ¬
â”œâ”€â”€ templates/                 # æ¨¡æ¿æ–‡ä»¶ç›®å½•ï¼ˆå¯é€‰ï¼‰
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ vite.config.ts
â””â”€â”€ README.md
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
pnpm install
```

### 2. ä¿®æ”¹æ’ä»¶ä¿¡æ¯

ç¼–è¾‘ `package.json`ï¼Œä¿®æ”¹ä»¥ä¸‹å­—æ®µï¼š

```json
{
    "name": "napcat-plugin-your-name",
    "description": "ä½ çš„æ’ä»¶æè¿°",
    "author": "ä½ çš„åå­—"
}
```

### 3. å¼€å‘ä½ çš„åŠŸèƒ½

- **æ·»åŠ é…ç½®é¡¹**: ç¼–è¾‘ `src/types.ts` å’Œ `src/config.ts`
- **æ¶ˆæ¯å¤„ç†**: ç¼–è¾‘ `src/handlers/message-handler.ts`
- **API è·¯ç”±**: ç¼–è¾‘ `src/services/api-service.ts`
- **çŠ¶æ€ç®¡ç†**: ç¼–è¾‘ `src/core/state.ts`

### 4. æ„å»º

```bash
pnpm run build
```

æ„å»ºäº§ç‰©åœ¨ `dist/` ç›®å½•ä¸‹ã€‚

## ğŸ“– æ¶æ„è¯´æ˜

### åˆ†å±‚æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      index.ts (å…¥å£)                         â”‚
â”‚         ç”Ÿå‘½å‘¨æœŸé’©å­ + WebUI è·¯ç”±æ³¨å†Œ + äº‹ä»¶åˆ†å‘              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                  â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Handlers    â”‚  â”‚   Services    â”‚  â”‚     WebUI     â”‚
â”‚  æ¶ˆæ¯å¤„ç†å…¥å£  â”‚  â”‚   ä¸šåŠ¡é€»è¾‘    â”‚  â”‚   å‰ç«¯ç•Œé¢    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  core/state   â”‚
        â”‚  å…¨å±€çŠ¶æ€å•ä¾‹  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒè®¾è®¡æ¨¡å¼

| æ¨¡å¼ | å®ç°ä½ç½® | è¯´æ˜ |
|------|----------|------|
| å•ä¾‹çŠ¶æ€ | `src/core/state.ts` | `pluginState` å…¨å±€å•ä¾‹ï¼ŒæŒæœ‰ ctxã€configã€logger |
| æœåŠ¡åˆ†å±‚ | `src/services/*.ts` | æŒ‰èŒè´£æ‹†åˆ†ä¸šåŠ¡é€»è¾‘ |
| é…ç½®æ ¡éªŒ | `sanitizeConfig()` | ç±»å‹å®‰å…¨çš„è¿è¡Œæ—¶é…ç½®éªŒè¯ |

## ğŸ”§ ç”Ÿå‘½å‘¨æœŸå‡½æ•°

| å¯¼å‡º | è¯´æ˜ |
|------|------|
| `plugin_init` | æ’ä»¶åˆå§‹åŒ–ï¼ŒåŠ è½½é…ç½®ã€æ³¨å†Œè·¯ç”± |
| `plugin_onmessage` | æ¶ˆæ¯äº‹ä»¶å¤„ç† |
| `plugin_cleanup` | æ’ä»¶å¸è½½ï¼Œæ¸…ç†èµ„æº |
| `plugin_config_ui` | WebUI é…ç½® Schema |
| `plugin_get_config` | è·å–é…ç½® |
| `plugin_set_config` | è®¾ç½®é…ç½® |
| `plugin_on_config_change` | é…ç½®å˜æ›´å›è°ƒ |

## ğŸ“ ç¼–ç çº¦å®š

### ESM æ¨¡å—è§„èŒƒ

- `package.json` ä¸­ `type: "module"`
- å¯¼å…¥ä½¿ç”¨ `.js` æ‰©å±•åï¼ˆTypeScript ç¼–è¯‘åï¼‰

### çŠ¶æ€è®¿é—®æ¨¡å¼

```typescript
import { pluginState } from '../core/state';

// è¯»å–é…ç½®
const config = pluginState.config;

// è®°å½•æ—¥å¿—
pluginState.log('info', 'æ¶ˆæ¯å†…å®¹');
pluginState.logDebug('è°ƒè¯•ä¿¡æ¯'); // ä»… debug æ¨¡å¼è¾“å‡º

// è°ƒç”¨ OneBot API
await pluginState.callApi('send_group_msg', { group_id, message });
```

### API å“åº”æ ¼å¼

```typescript
// æˆåŠŸå“åº”
res.json({ code: 0, data: { ... } });

// é”™è¯¯å“åº”
res.status(500).json({ code: -1, message: 'é”™è¯¯æè¿°' });
```

## ğŸ“¦ éƒ¨ç½²

å°† `dist/` ç›®å½•çš„å†…å®¹å¤åˆ¶åˆ° NapCat çš„æ’ä»¶ç›®å½•å³å¯ã€‚

## ğŸ“„ è®¸å¯è¯

MIT License
